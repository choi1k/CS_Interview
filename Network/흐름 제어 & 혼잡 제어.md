# 흐름 제어 & 혼잡 제어

### TCP란?

높은 신뢰성을 보장하는 연결 지향 방식의 전송 제어 프로토콜

TCP를 사용하면 unreliable network에서 reliable network를 보장할 수 있음

TCP는 network congestion avoidance algorithm을 사용함

* reliable network를 보장함으로써 피할 수 있는 4가지 문제

        1. 손실 : packet이 손실될 수 있는 문제

        2. 순서 바뀜 : packet의 순서가 바뀌는 문제

        3. Congestion : 네트워크가 혼잡한 문제

        4. Overload : receiver가 overload되는 문제

### 흐름 제어

* 흐름 제어란?

    수신 측의 데이터 처리 속도보다 송신 측의 속도가 빠를 경우 문제가 발생하게 됨

    수신 측에서 제한된 저장 용량을 초과한 이후에 도착하는 패킷은 손실될 수 있으며, 손실된다면 불필요한 추가 패킷 전송이 발생하게 됨

    흐름 제어는 이와 같은 송신 측과 수신 측의 TCP 버퍼 크기 차이로 인해 생기는 데이터 처리 속도 차이를 해결하기 위한 기법임

        TCP 버퍼
        송신 측은 버퍼에 TCP 세그먼트를 보관한 후 순차적으로 전송하고, 수신 측은 도착한 TCP 세그먼트를 애플리케이션이 읽을 때까지 버퍼에 보관함

* Stop and Wait

    매번 전송한 패킷에 대해 확인 응답(ACK)를 받으면 다음 패킷을 전송하는 방법

    패킷을 하나씩 보내기 때문에 비효율적

* Sliding Window

    수신 측에서 설정한 Window size 만큼 송신 측에서 확인 응답(ACK)없이 패킷을 전송할 수 있게하여 데이터 흐름을 동적으로 조절하는 제어 기법

        Window size
        한번에 받을 수 있는 데이터의 양
        통신할 때 송신 측에 Window size를 알려주면 송신 측은 수신 측에 Window size 만큼 데이터를 전송하고,
         수신 측이 이를 모두 처리했는지 확인 후 다음 데이터를 전송하게 됨

    * 동작 방식

        윈도우에 포함된 패킷을 계속 전송하고, 수신 측으로부터 확인 응답(ACK)이 오면 윈도우를 옆으로 sliding시켜 다음 패킷을 전송함

* 재전송

    송신 측은 일정 시간 동안 수신 측으로부터 확인 응답(ACK)을 받지 못하면, 패킷을 재전송함

    송신 측에서 재전송 시 패킷이 소실된 것이 아니고 수신 측의 버퍼에 남는 공간이 없는 것이라면 문제가 발생하게 됨

    이를 예방하기 위해 송신 측은 해결 응답(ACK)을 보내면서 남은 버퍼의 크기(Window size)도 함께 보냄

### 혼잡 제어

* 혼잡 제어란?

    데이터의 양이 라우터가 처리할 수 있는 양을 초과하게 되면 송신 측에서는 라우터가 처리하지 못한 데이터를 손실 데이터로 간주함\
    해당 데이터는 계속해서 재전송 되며 네트워크를 혼잡하게 함

    혼잡 제어는 송신 측의 전송 속도를 적절히 조절하여 이러한 상황을 예방하는 기법임

* AIMD(Additive Increase/Multiplicative Decrease)

    처음에 한개의 패킷을 보내고 문제 없이 도착하면 Window size를 1씩 증가시켜 전송함

    만약, 전송에 실패하면 Window size를 반으로 줄임

    Window size를 너무 조금씩 늘리기 때문에 네트워크의 모든 대역을 활용한 제대로 된 속도의 통신까지는 시간이 오래 걸리는 단점이 있음

* Slow Start(느린 시작)

    속도가 느린 AIMD 방식에 비해, Slow Start는 윈도우 크기를 1, 2, 4, .. 처럼 지수적으로 증가시키고 혼잡이 감지되면 Window size를 1로 줄임

    ACK이 도착할 때마다 Window Size를 증가시키기 때문에 초반에는 Window size가 느리게 증가하지만 점점 빠르게 증가하는 장점이 있음

* Fast Retransmit(빠른 재전송)

    패킷을 받는 수신 측에서는 세그먼트로 분할 된 내용이 순서대로 도착하지 않는 문제가 발생할 수 있음

    이때, 수신 측에서는 순서대로 잘 도착한 마지막 패킷의 다음 순번을 ACK 패킷에 실어보냄

    이러한 ACK 패킷을 중복으로 받게되면 재전송이 수행됨

    송신 측은 자신이 설정한 타임 아웃 시간이 지나지 않아도 바로 해당 패킷을 재전송할 수 있기 때문에 보다 빠른 재전송률을 유지할 수 있음

* Fast Recovery(빠른 회복)

    혼잡 상태가 되면 Window size를 1로 줄이지 않고 반으로 줄임
    
    이후, AIMD 방식으로 선형적으로 Window size를 증가시킴