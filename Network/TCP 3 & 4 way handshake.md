# 3 way handshake & 4 way handshake

<br>

> 연결을 성립하고 해제하는 과정

<br>

<br>

## 3 way handshake - 연결 성립

---

<br>

TCP는 정확한 전송을 보장해야 함. 따라서 통신하기에 앞서, 논리적인 접속을 성립하기 위해 3 way handshake 과정을 진행

<br>

![image](https://user-images.githubusercontent.com/75096085/214343633-67dc5494-739e-443f-8b46-4b10fd5da4cb.png)

<br>
### 1단계

클라이언트 측 TCP는 서버 TCP에게 특별한 TCP 세그먼트인 **SYN 세그먼트**를 송신함.

SYN 세그먼트는 세그먼트의 헤더에 SYN비트라고 불리는 하나의 플래그 비트를 가짐. 

<br>

### 2단계

TCP SYN 세그먼트를 포함하는 IP 데이터그램이 서버 호스트에 도착했을 때, 서버는 데이터그램으로부터 TCP SYN 세그먼트를 뽑아냄. 

그리고 연결해 TCP버퍼와 변수들을 할당함.

또한 클라이언트 TCP로 연결 승인 세그먼트(**SYNACK**)를 송신함. 


<br>

### 3단계

SYNACK 세그먼트를 수신하면, 클라이언트는 연결에 버퍼와 변수들을 할당함. 그다음 서버로 또 다른 세그먼트를 송신함. 


세 단계가 완료되면 클라이언트와 서버 호스트들은 각각 서로에게 데이터를 포함하는 세그먼트를 보낼 수 있음. 


<br>

<br>


## 4 way handshake (연결 종료)

---

<br>

클라이언트가 연결 종료를 결정한다고 가정할 떄,

<br>

![image](https://user-images.githubusercontent.com/75096085/214343714-84625cfd-2ca3-4853-92c7-3ae79b7e9681.png)

<br>

### 1단계

클라이언트 애플리케이션 프로세스는 종료 명령을 내림. 클라이언트 TCP가 서버 프로세스에게 특별한 TCP 세그먼트를 보내도록 함.  

1로 설정된 **FIN** 비트라 불리는 플래그 비트를 세그먼트 헤더에 포함하고 있음.

<br>

### 2단계

서버가 이 세그먼트를 수신하면, 서버는 클라이언트에게 확인 세그먼트를 보냄. (**ACK**)

<br>

### 3단계 

서버가 **FIN** 비트가 1로 설정된 자신의 종료 세그먼트를 송신함.

<br>

### 4단계

클라이언트는 서버의 종료 세그먼트에 확인 응답을 함. (**ACK**) 이 시점에서 두 호스트의 모든 자원들은 할당이 해제됨. 
